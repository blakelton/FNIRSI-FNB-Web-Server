version: '3.8'

services:
  fnb58-monitor:
    build: .
    image: fnb58-monitor:latest
    container_name: fnb58-monitor
    restart: unless-stopped

    # Network configuration
    ports:
      - "5000:5000"

    # For Bluetooth support, use host network (Linux only)
    # Uncomment the line below and comment out the ports section above
    # network_mode: host

    # USB device access
    # Adjust device path based on your system
    devices:
      - /dev/bus/usb:/dev/bus/usb

    # Required for USB and Bluetooth access
    privileged: true

    # Environment variables
    environment:
      - FLASK_ENV=production
      - HOST=0.0.0.0
      - PORT=5000
      # Optional: Set Bluetooth device address
      # - BT_DEVICE_ADDRESS=98:DA:B0:08:A1:82

    # Persistent storage for sessions and exports
    volumes:
      - ./sessions:/app/sessions
      - ./exports:/app/exports
      # Optional: Mount custom config
      # - ./.env:/app/.env:ro

    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5000/api/status')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# Optional: Add reverse proxy for HTTPS
#  nginx:
#    image: nginx:alpine
#    container_name: fnb58-nginx
#    restart: unless-stopped
#    ports:
#      - "80:80"
#      - "443:443"
#    volumes:
#      - ./nginx.conf:/etc/nginx/nginx.conf:ro
#      - ./ssl:/etc/nginx/ssl:ro
#    depends_on:
#      - fnb58-monitor

volumes:
  # Named volumes for data persistence
  sessions:
    driver: local
  exports:
    driver: local
