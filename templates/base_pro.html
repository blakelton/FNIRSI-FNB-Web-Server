<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}FNIRSI USB Monitor Professional{% endblock %}</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Chart.js Zoom Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Custom Professional CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/professional.css') }}">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar-pro">
        <div class="nav-left">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24">
                    <path d="M7 2v11h3v9l7-12h-4l4-8z"/>
                </svg>
                <span class="logo-text" id="device-name-header">FNIRSI FNB</span>
                <span class="logo-subtitle">PROFESSIONAL</span>
            </div>
        </div>

        <div class="nav-center">
            <div class="nav-links">
                <a href="/dashboard" class="nav-link active">
                    <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                    DASHBOARD
                </a>
                <a href="/history" class="nav-link">
                    <svg class="nav-icon" viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
                    HISTORY
                </a>
                <a href="/settings" class="nav-link">
                    <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    SETTINGS
                </a>
            </div>
        </div>

        <div class="nav-right">
            <div class="system-status">
                <div class="status-item">
                    <span class="status-label">CPU</span>
                    <span class="status-value" id="cpu-usage">0%</span>
                </div>
                <div class="status-item">
                    <span class="status-label">MEM</span>
                    <span class="status-value" id="mem-usage">0.00/0.00GB</span>
                </div>
                <div class="status-item">
                    <span class="status-label">TIME</span>
                    <span class="status-value" id="current-time">00:00:00</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container-pro" class="toast-container-pro"></div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-content" id="modal-content"></div>
    </div>

    <!-- Common JavaScript -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script>
        // Update clock
        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour12: false });
            const timeEl = document.getElementById('current-time');
            if (timeEl) timeEl.textContent = timeStr;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Fetch real system stats
        async function updateSystemStats() {
            try {
                const response = await fetch('/api/system-stats');
                const data = await response.json();

                if (data.success) {
                    const cpuEl = document.getElementById('cpu-usage');
                    const memEl = document.getElementById('mem-usage');

                    if (cpuEl) cpuEl.textContent = data.cpu_percent + '%';
                    if (memEl) memEl.textContent = data.memory_used_gb.toFixed(2) + '/' + data.memory_total_gb.toFixed(2) + 'GB';
                }
            } catch (error) {
                // Fallback to mock data if API fails
                const cpuEl = document.getElementById('cpu-usage');
                const memEl = document.getElementById('mem-usage');
                if (cpuEl) cpuEl.textContent = '15.2%';
                if (memEl) memEl.textContent = '4.50/16.00GB';
            }
        }
        setInterval(updateSystemStats, 2000);
        updateSystemStats();

        // Update device name in header based on connected device
        async function updateDeviceName() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                const nameEl = document.getElementById('device-name-header');

                if (data.connected && data.device_info && data.device_info.name) {
                    // Use actual device name (e.g., "FNB48P", "FNB58", etc.)
                    const deviceName = data.device_info.name.toUpperCase();
                    if (nameEl) nameEl.textContent = 'FNIRSI ' + deviceName;
                } else {
                    // Default when not connected
                    if (nameEl) nameEl.textContent = 'FNIRSI FNB';
                }
            } catch (error) {
                // Keep default on error
            }
        }
        setInterval(updateDeviceName, 3000);
        updateDeviceName();

        // Set active navigation link based on current page
        function setActiveNavLink() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                link.classList.remove('active');
                const href = link.getAttribute('href');

                // Match exact path or if we're on dashboard and it's the dashboard link
                if (href === currentPath ||
                    (currentPath === '/' && href === '/dashboard') ||
                    (currentPath === '/dashboard' && href === '/dashboard') ||
                    (currentPath.startsWith('/history') && href === '/history') ||
                    (currentPath.startsWith('/settings') && href === '/settings')) {
                    link.classList.add('active');
                }
            });
        }

        // Run on load
        document.addEventListener('DOMContentLoaded', setActiveNavLink);
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
